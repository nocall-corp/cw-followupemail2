# Webhookリファレンス

# 導入

nocallシステムからWebhookを通じて通話情報を受け取るための仕様を説明します。このWebhookは通話が完了した際など、特定のイベントが発生した時に、事前に登録されたURLに対してHTTP POSTリクエストを送信します。

## Webhook登録方法

Webhookを利用するには、システム内でWebhook URLを登録する必要があります。

## ペイロード

リクエストメソッド：HTTP POST

リクエストヘッダー：Content-Type: application/json

リクエストボディ：サンプル

```json
{
  "id": "call_123",
  "timestamp": "2025-03-28T15:45:05.24+09:00",
  "callStatus": "completed",
  "from": "+815012345678",
  "to": "+819098765432",
  "detailsUrl": "https://console.nocall.ai/console/call-history/XXX",
  "endUser": {
    "id": "end_user_123",
    "phoneNumber": "+819098765432",
    "attributions": {
      "姓": "山田",
      "名": "太郎",
      "セイ": "ヤマダ",
      "メイ": "タロウ",
      "会社名": "岡本商事",
      "メールアドレス": "yamada@example.com"
    }
  },
  "conversation": {
    "messages": [
      { "role": "system", "content": "system message" },
      { "role": "assistant", "content": "assistant message" },
      { "role": "user", "content": "user message" },
      {
        "role": "assistant_tool_call",
        "tool_calls": [
          {
            "id": "tool_call_123",
            "name": "tool name",
            "args": { "arg1": "value1", "arg2": "value2" }
          }
        ]
      },
      {
        "role": "tool",
        "content": "tool message",
        "name": "tool name",
        "tool_call_id": "tool_call_123"
      }
    ],
    "startTime": "2025-03-28T15:40:05.24+09:00",
    "endTime": "2025-03-28T15:45:05.24+09:00",
    "duration": 300000,
    "goalStatus": "achieved",
    "goalResult": "成功しました。"
  },
  "agent": {
		"id": 1,
		"name": "agent1"
	},
}
```

## **各フィールドの説明**

### **トップレベルフィールド**

| フィールド名 | 型 | 説明 |
| --- | --- | --- |
| id | string | 通話の一意識別子 |
| timestamp | string | Webhook送信時刻（ISO 8601形式、タイムゾーンなし） |
| callStatus | string | 通話状態
**`preparing`** ：準備中
**`ringing`** ：通話中
**`completed`**：完了
**`no_answer`** ：不在
**`failed`** ：失敗 |
| from | string | 発信元電話番号（国際形式、例：**`+815012345678`**） |
| to | string | 着信先電話番号（国際形式、例：**`+819098765432`**） |

### **endUserオブジェクト**

| フィールド名 | 型 | 説明 |
| --- | --- | --- |
| id | string | エンドユーザーの一意識別子 |
| phoneNumber | string | エンドユーザーの電話番号（国際形式） |
| attributes | object | エンドユーザーの属性情報。現在は、姓、名、セイ、メイ、会社名、メールアドレスで固定 |

### **conversationオブジェクト**

callStatusがcompletedの時のみ存在します。

| フィールド名 | 型 | 説明 |
| --- | --- | --- |
| message | array | 会話メッセージの配列 |
| startTime | string | 通話開始時刻（ISO 8601形式、タイムゾーンなし） |
| endTime | string | 通話終了時刻（ISO 8601形式、タイムゾーンなし） |
| duration | number | 通話時間（ミリ秒） |
| goalStatus | string | 通話目標の達成状態
**`pending`**：未実行
**`achieved`**：達成
**`failed`**：失敗 |
| goalResult | string | 通話目標の達成結果 |

### **messageオブジェクト**

**`Message`**オブジェクトは会話中のメッセージを表現するための型定義で、3つの異なる形式があります。

**基本的なメッセージ形式**

これは最も一般的なメッセージ形式で、次の要素があります：

- **`role`**: メッセージの送信者を表します
    - **`system`**: システムからの指示や設定
    - **`assistant`**: AIアシスタントからの応答
    - **`user`**: エンドユーザーからの入力

```json
{
  role: "system" | "assistant" | "user"; // メッセージの送信者
  content: string; // メッセージの本文
}
```

**アシスタントツール呼び出しメッセージ**

これはAIアシスタントがツールを呼び出す際に使用するメッセージで、次の要素があります：

```json
{
  role: "assistant_tool_call";
  tool_calls: [
    {
      id: string; // ツール呼び出しの一意識別子
      name: string; // 呼び出すツールの名前
      args: Record<string, any>; //  ツールに渡す引数（キーと値のペア）
    }
  ];
}
```

**ツール実行結果のメッセージ**

これはツールが実行された結果を表すメッセージで、次の要素があります：

```json
{
  role: "tool";
  content: string; // ツール実行の結果
  name: string; // 実行されたツールの名前
  tool_call_id: string; // ツール呼び出しの一意識別子
}
```

### **angentオブジェクト**

| フィールド名 | 型 | 説明 |
| --- | --- | --- |
| id | string | 利用されたエージェントの一意識別子 |
| name | string | 利用されたエージェントの名称 |

## **テスト方法**

API管理画面から登録済みのWebhook URLにテストリクエストを送信できます。テストデータは上記の形式で送信されます。

---

このページをダウンロード↓

[2be3a500-f9ce-4c8e-b87e-951e79836c77_Webhookリファレンス.pdf](Webhook%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%201c0295fd2008809ea92ec600fa7f16d2/2be3a500-f9ce-4c8e-b87e-951e79836c77_Webhook%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9.pdf)